@model ProductDetailsModel.AddToCartModel
@using Nop.Core.Domain.Orders
@if (Model.CustomerEntersPrice)
{
    <div class="customer-entered-price">
        <div class="price-input">
            <label asp-for="CustomerEnteredPrice" asp-postfix=":" class="enter-price-label"></label>
            @*round price*@
            <input asp-for="CustomerEnteredPrice" value="@Convert.ToInt32(Math.Ceiling(Model.CustomerEnteredPrice))" class="enter-price-input" />
        </div>
        <div class="price-range">
            @Model.CustomerEnteredPriceRange
        </div>
    </div>
}

@if (!string.IsNullOrEmpty(Model.MinimumQuantityNotification))
{
    <div class="min-qty-notification">@Model.MinimumQuantityNotification</div>
}
@if (Model.UpdatedShoppingCartItemId > 0)
{
    <input asp-for="UpdatedShoppingCartItemId" type="hidden" />
}
@if (!Model.DisableBuyButton || Model.CustomerEntersPrice)
{
    @if (!Model.DisableBuyButton)
    {
        <div class="mt-shop-details__quantity-box">
            @if (Model.AllowedQuantities.Count > 0)
            {
                <select asp-for="EnteredQuantity" asp-items="Model.AllowedQuantities" id="product_enteredQuantity_@Model.ProductId" class="qty-dropdown" aria-label=@T("Products.Qty.AriaLabel")></select>
                <script asp-location="Footer">
                    $(function() {
                        $("#product_enteredQuantity_@Model.ProductId").on("change", function () {
                            var data = {
                                productId: @Model.ProductId,
                                quantity: $('#product_enteredQuantity_@Model.ProductId').find(":selected").text()
                            };
                            $(document).trigger({ type: "product_quantity_changed", changedData: data });
                        });
                    });
                </script>
            }
            else
            {
                <div class="mt-shop-details__quantity-box">
                    <div class="mt-shop-details__quantity">
                        <div class="mt-cart-minus mt-cart-min-plus"><i class="fal fa-minus"></i></div>
                        <input asp-for="EnteredQuantity" id="product_enteredQuantity_@Model.ProductId" aria-label=@T("Products.Qty.AriaLabel") type="text" value="01" />
                        <div class="mt-cart-plus mt-cart-min-plus"><i class="fal fa-plus"></i></div>
                    </div>
                </div>

                <script asp-location="Footer">
                    //when a customer clicks 'Enter' button we submit the "add to cart" button (if visible)
                    $(function() {
                        $("#@Html.IdFor(model => model.EnteredQuantity)").on("keydown", function(event) {
                            if (event.keyCode == 13) {
                                $("#add-to-cart-button-@Model.ProductId").trigger("click");
                                return false;
                            }
                        });

                        $("#product_enteredQuantity_@Model.ProductId").on("input propertychange paste", function () {
                            var data = {
                                productId: @Model.ProductId,
                                quantity: $('#product_enteredQuantity_@Model.ProductId').val()
                            };
                            $(document).trigger({ type: "product_quantity_changed", changedData: data });
                        });
                    });
                </script>
            }

        </div>
        <div class="mt-shop-details__btn mr-12">
            @{
                var addToCartText = "";
                if (Model.UpdatedShoppingCartItemId > 0 && Model.UpdateShoppingCartItemType.HasValue && Model.UpdateShoppingCartItemType.Value == ShoppingCartType.ShoppingCart)
                {
                    addToCartText = T("ShoppingCart.AddToCart.Update").Text;
                }
                else
                {
                    addToCartText = T("ShoppingCart.AddToCart").Text;
                    if (Model.IsRental)
                    {
                        addToCartText = T("ShoppingCart.Rent").Text;
                    }
                    if (Model.AvailableForPreOrder)
                    {
                        addToCartText = T("ShoppingCart.PreOrder").Text;
                    }
                }
                <a class="mt-btn" href="javascript:void(0)" id="add-to-cart-button-@Model.ProductId" data-productid="@Model.ProductId" onclick="AjaxCart.addproducttocart_details('@Url.RouteUrl(NopRouteNames.Ajax.ADD_PRODUCT_TO_CART_DETAILS, new { productId = Model.ProductId, shoppingCartTypeId = (int)ShoppingCartType.ShoppingCart })', '#product-details-form');return false;">
                    <i class="fa-solid fa-basket-shopping"></i><span class="ml-6">@addToCartText</span>
                </a>

            }

        </div>

    }
    <div class="mt-shop-list-btn">
        <a href="wishlist.html"><i class="fa-regular fa-heart"></i></a>
        <a href="product-details.html"><i class="fa-sharp fa-regular fa-rotate"></i></a>

    </div>
    @await Component.InvokeAsync(typeof(WidgetViewComponent), new { widgetZone = PublicWidgetZones.ProductDetailsAddInfo, additionalData = Model })

}
